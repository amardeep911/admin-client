import{A as T,u as M,e as C,r as i,j as e,B as E,I,a as y}from"./index-DP5l2bTG.js";import{h as o}from"./moment-C5S46NFB.js";import{S as L,a as F,b as k,c as B,d as _,f as $,e as b}from"./Select-CIZ63-gD.js";import"./index-BeS4TZan.js";import"./index-BoyYGgaP.js";const P=()=>{const x=M(),{id:d}=C(),[p,D]=i.useState([]),[S,g]=i.useState({}),[u,Y]=i.useState("All"),[j,R]=i.useState(10),[v,U]=i.useState(1),w=()=>x("/sms-history");i.useEffect(()=>{const s=async()=>{try{const r=await y.get(`/transaction-history?userId=${d}`);D(Array.isArray(r.data)?r.data:[])}catch(r){console.error("Failed to fetch SMS history details:",r)}},t=async()=>{try{const r=await y.get(`/get-user?userId=${d}`);g(r.data)}catch{console.error("Failed to fetch user data")}};s(),t()},[d]);let c=(s=>{if(!Array.isArray(s))return[];const t=s.reduce((l,a)=>(l[a.id]||(l[a.id]=[]),l[a.id].push(a),l),{});return Object.values(t).map(l=>{const a=l.filter(n=>n.status==="FINISHED"),N=l.filter(n=>n.status==="CANCELLED");return{...N.length>0?N[0]:a.find(n=>n.otp!==null)||a[0],otps:a.filter(n=>n.otp).map(n=>n.otp).join("<br><br>")||"-"}})})(p);u==="Success"?c=c.filter(s=>s.status==="FINISHED"):u==="Cancelled"&&(c=c.filter(s=>s.status==="CANCELLED"));const h=c.sort((s,t)=>o(t.date_time,"MM/DD/YYYYTHH:mm:ss A").isBefore(o(s.date_time,"MM/DD/YYYYTHH:mm:ss A"))?1:-1).reverse(),A=s=>{if(s.length===0)return"No data available";const t=s.map(a=>o(a.date_time,"MM/DD/YYYYTHH:mm:ss A")),r=o.min(t),l=o.max(t);return`${r.format("DD/MM/YY")} - ${l.format("DD/MM/YY")}`},f=(v-1)*j,H=Array.isArray(h)?h.slice(f,f+j):[],m={wordBreak:"break-word",whiteSpace:"normal",overflowWrap:"break-word"};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full my-4 flex items-center justify-between",children:e.jsxs(E,{variant:"link",onClick:w,className:"text-sm font-normal text-[#8C8C8C] !no-underline p-1 h-0 flex gap-2",children:[e.jsx(I.arrowLeft,{className:"w-4 h-4"})," Sms History Details"]})}),e.jsx("div",{className:"flex items-center justify-center pt-[1rem]",children:e.jsxs("div",{className:"bg-transparent w-full max-w-md rounded-lg mb-[60px] border-none dark",children:[e.jsxs("div",{className:"bg-[#484848] text-sm py-3 px-5 flex mb-4 w-full items-center justify-between rounded-lg",children:[e.jsx("h3",{className:"font-medium pr-4 border-r",children:"Email"}),e.jsx("p",{className:"font-normal pl-4 text-[#9B9B9B]",style:m,children:S.email})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(O,{setTranFilter:Y,transFilter:u}),e.jsxs("p",{className:"min-w-fit text-sm",children:["Total: ",c.length]})]}),e.jsx("div",{className:"flex items-center justify-center gap-4",children:e.jsxs("p",{className:"text-[#A5A5A5] text-sm",children:["Data:"," ",e.jsx("span",{className:"text-white font-normal text-xs",children:A(H)})]})}),h.length>0?h.map((s,t)=>e.jsx("div",{className:"mt-[1.5rem] w-full border-[10px] border-[#444444] rounded-lg",children:e.jsx("table",{className:"w-full table-auto text-sm",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"SL No"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",children:t+1})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"ID"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:m,children:s.id})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Number"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:m,children:s.number})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"OTP"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",children:e.jsx("span",{dangerouslySetInnerHTML:{__html:s.otps}})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Date & Time"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:m,children:o(s.date_time,"MM/DD/YYYYTHH:mm:ss A").format("DD/MM/YYYY hh:mm:ss A")})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Service"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",style:m,children:s.service})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border-b-2 border-[#949494] p-3 px-5 text-[#959595]",children:"Status"}),e.jsx("td",{className:"border-b-2 border-[#949494] p-3",children:s.status})]})]})})},t)):e.jsx("div",{className:"text-center text-[#959595] mt-10 text-lg",children:"No transactions found"})]})})]})},O=({transFilter:x,setTranFilter:d})=>e.jsxs(L,{value:x,onValueChange:p=>d(p),children:[e.jsx(F,{className:"dark bg-transparent w-fit",children:e.jsx(k,{children:x})}),e.jsx(B,{className:"dark bg-[#1e1e1e]",children:e.jsxs(_,{children:[e.jsx($,{className:"font-normal",children:"Filter"}),e.jsx(b,{value:"All",children:"All"}),e.jsx(b,{value:"Success",children:"Success"}),e.jsx(b,{value:"Cancelled",children:"Cancelled"})]})})]}),Q=T()(P);export{Q as default};
